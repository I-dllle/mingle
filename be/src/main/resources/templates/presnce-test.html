<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Presence ìƒíƒœ í…ŒìŠ¤íŠ¸</title>
  </head>
  <body>
    <h2>âœ… Presence ìƒíƒœ í…ŒìŠ¤íŠ¸</h2>

    <label>ğŸ†” ìœ ì € ID: <input type="number" id="userId" value="1" /></label
    ><br /><br />
    <label>ğŸ” JWT í† í°: <input type="text" id="token" size="80" /></label
    ><br /><br />

    <button onclick="connectWebSocket()">ğŸ”Œ WebSocket ì—°ê²°</button>
    <button onclick="sendPing()">ğŸ’“ ping ì „ì†¡</button>
    <button onclick="sendTabHidden()">ğŸ™ˆ tab_hidden ì „ì†¡</button>
    <hr />

    <button onclick="setManualStatus('ONLINE')">ğŸŸ¢ ìë™ ìƒíƒœ ë³µê·€</button>
    <button onclick="setManualStatus('AWAY')">ğŸŸ¡ ìë¦¬ë¹„ì›€ ì„¤ì •</button>
    <button onclick="setManualStatus('DO_NOT_DISTURB')">
      ğŸš« ë°©í•´ê¸ˆì§€ ì„¤ì •
    </button>
    <hr />

    <button onclick="checkStatus()">ğŸ” ìƒíƒœ ì¡°íšŒ</button>
    <pre id="result">[ìƒíƒœ ì¶œë ¥ ì˜ì—­]</pre>

    <script>
      let socket;

      function connectWebSocket() {
        const token = document.getElementById("token").value;
        const roomId = "testroom"; // í…ŒìŠ¤íŠ¸ìš© roomId
        socket = new WebSocket(
          `ws://localhost:8080/ws/chat/${roomId}?token=${token}`
        );

        socket.onopen = () => console.log("âœ… WebSocket ì—°ê²°ë¨");
        socket.onmessage = (event) =>
          console.log("ğŸ“© ë©”ì‹œì§€ ìˆ˜ì‹ :", event.data);
        socket.onclose = () => console.log("âŒ WebSocket ì¢…ë£Œ");
      }

      function sendPing() {
        socket.send("ping");
        console.log("ğŸ’“ ping ì „ì†¡ë¨");
      }

      function sendTabHidden() {
        socket.send("tab_hidden");
        console.log("ğŸ™ˆ tab_hidden ì „ì†¡ë¨");
      }

      async function setManualStatus(status) {
        const token = document.getElementById("token").value;
        const res = await fetch("/api/v1/presence/manual-status", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
          body: JSON.stringify({ status }),
        });

        const resultEl = document.getElementById("result");
        if (res.ok) {
          resultEl.innerText = `âœ… ìˆ˜ë™ ìƒíƒœ "${status}" ì„¤ì • ì™„ë£Œ`;
        } else {
          resultEl.innerText = `âŒ ìƒíƒœ ì„¤ì • ì‹¤íŒ¨ (${res.status})`;
        }
      }

      async function checkStatus() {
        const userId = document.getElementById("userId").value;
        const res = await fetch("http://localhost:8080/api/v1/presence/1");
        const data = await res.json();
        document.getElementById("result").innerText = JSON.stringify(
          data,
          null,
          2
        );
      }
    </script>
  </body>
</html>
